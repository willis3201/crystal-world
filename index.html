<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Crystal AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00f2ff; --bg: #0a0a12; --panel: #161622; --text: #e0e0e0; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Roboto', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { max-width: 600px; width: 100%; display: flex; flex-direction: column; gap: 20px; }
        h2 { font-family: 'Orbitron', sans-serif; text-align: center; }
        .upload-section { background: var(--panel); border: 2px dashed #444; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #previewImage { max-width: 100%; max-height: 300px; display: none; border-radius: 8px; margin-top: 10px; }
        .btn-analyze { background: linear-gradient(90deg, #bd00ff, #00f2ff); border: none; color: white; padding: 15px; width: 100%; border-radius: 8px; font-family: 'Orbitron'; font-size: 1.1rem; cursor: pointer; font-weight: bold; }
        .btn-analyze:disabled { background: #333; color: #666; cursor: not-allowed; }
        .results-panel { display: none; background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid #333; }
        .freq-number { font-size: 3rem; font-family: 'Orbitron'; color: var(--primary); text-align: center; text-shadow: 0 0 10px rgba(0,242,255,0.3); }
        .freq-title { font-size: 1.2rem; text-align: center; font-weight: bold; letter-spacing: 2px; }
        .log-box { background: #000; padding: 10px; height: 100px; overflow-y: auto; font-family: monospace; font-size: 0.8rem; color: #0f0; margin-top: 20px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <h2>CFPS <span style="color:var(--primary)">AI VISION</span></h2>
    
    <div class="upload-section" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)" style="display:none;">
        <div id="uploadPlaceholder">
            <div style="font-size:3rem; margin-bottom:10px;">ğŸ’</div>
            <h3>ä¸Šå‚³æ°´æ™¶ç…§ç‰‡</h3>
        </div>
        <img id="previewImage">
    </div>

    <button class="btn-analyze" id="analyzeBtn" onclick="runAnalysis()" disabled>å•Ÿå‹• AI è¦–è¦ºåˆ†æ</button>

    <div class="results-panel" id="resultsPanel">
        <div class="freq-number" id="finalFreq">--- Hz</div>
        <div class="freq-title" id="finalTitle">Loading...</div>
        <div style="position: relative; height:250px; width:100%; margin-top:20px;">
            <canvas id="radarChart"></canvas>
        </div>
        <div class="log-box" id="systemLog"></div>
    </div>
</div>

<script>
    let currentFile = null;

    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            currentFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('previewImage');
                img.src = e.target.result;
                img.style.display = 'block';
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('resultsPanel').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    }

    async function runAnalysis() {
        if (!currentFile) return;

        const btn = document.getElementById('analyzeBtn');
        btn.disabled = true;
        btn.innerText = "æ­£åœ¨é€£ç·š Google Gemini...";
        
        document.getElementById('resultsPanel').style.display = 'block';
        document.getElementById('systemLog').innerHTML = "<div>> æ­£åœ¨å°‡ç…§ç‰‡ç™¼é€è‡³å¾Œç«¯ä¼ºæœå™¨ (Port 5001)...</div>";

        const formData = new FormData();
        formData.append('image', currentFile);

        try {
            // é€£æ¥åˆ° Python Server
            const response = await fetch('http://127.0.0.1:5001/analyze', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error("ä¼ºæœå™¨é€£ç·šå¤±æ•—");

            const data = await response.json();
            updateUI(data);

        } catch (error) {
            document.getElementById('systemLog').innerHTML += `<div style="color:red">> Error: ${error.message} (è«‹ç¢ºèª server.py æœ‰æ²’æœ‰åœ¨è·‘)</div>`;
            btn.innerText = "é‡è©¦";
            btn.disabled = false;
        }
    }

    function updateUI(data) {
        document.getElementById('analyzeBtn').innerText = "å•Ÿå‹• AI è¦–è¦ºåˆ†æ";
        document.getElementById('analyzeBtn').disabled = false;
        document.getElementById('finalFreq').innerText = data.frequency_hz + " Hz";
        document.getElementById('finalFreq').style.color = data.color_hex;
        document.getElementById('finalTitle').innerText = data.name.toUpperCase();
        document.getElementById('finalTitle').style.color = data.color_hex;

        const logBox = document.getElementById('systemLog');
        logBox.innerHTML += `<div>> è­˜åˆ¥çµæœ: ${data.name}</div>`;
        logBox.innerHTML += `<div>> èƒ½é‡æè¿°: ${data.description}</div>`;

        drawRadar(data.radar_values, data.color_hex);
    }

    let radarChartInstance = null;
    function drawRadar(values, color) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(radarChartInstance) radarChartInstance.destroy();
        radarChartInstance = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['éˆæ€§', 'æ‰æ ¹', 'è¡Œå‹•', 'é˜²ç¦¦', 'å¿ƒè¼ª'],
                datasets: [{
                    label: 'èƒ½é‡åˆ†æ',
                    data: values,
                    backgroundColor: 'rgba(255, 255, 255, 0.1)',
                    borderColor: color,
                    pointBackgroundColor: '#fff',
                    borderWidth: 2
                }]
            },
            options: {
                scales: { r: { angleLines: {color:'#333'}, grid: {color:'#333'}, ticks: {display: false, max:100, min:0} } },
                plugins: { legend: {display:false} }
            }
        });
    }
</script>
</body>
</html>